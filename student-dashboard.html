<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack Admin Portal</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="student.css">
</head>

<body>

    <nav class="sidebar">
        <div class="logo-section">
            <i class="fa-solid fa-graduation-cap"></i>
            <span class="logo-text">EduTrack</span>
        </div>

        <div class="menu">

            <a href="myCourse.html"
                onclick="showToast('Courses', 'Module is loading...', 'success'); activateMenu(this)"
                target="content_frame" class="menu-item active">
                <i class="fa-solid fa-chart-pie"></i>
                <span>My Course</span>
            </a>

            <a href="grades.html" onclick="showToast('Grades', 'Grades is loading...', 'success'); activateMenu(this)"
                target="content_frame" class="menu-item">
                <i class="fa-solid fa-users"></i>
                <span>Grades</span>
            </a>
            <a href="profile.html" class="menu-item"
                onclick="showToast('profile', 'profile to bank...', 'success'); activateMenu(this)"
                target="content_frame">
                <i class="fa-solid fa-user"></i>
                <span>profile</span>
            </a>

        </div>

        <div class="logout-section">
            <button id="logoutBtn" class="btn-logout" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Log Out</span>
            </button>
        </div>
    </nav>

    <div class="content-area">
        <iframe name="content_frame" id="content_frame" src="myCourse.html" frameborder="0"></iframe>
    </div>


    <div id="toast-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAMRV4fGPR7XobJjUd27a5F9cK3w8IBbAI",
            authDomain: "edu-lms-e2f94.firebaseapp.com",
            projectId: "edu-lms-e2f94",
            storageBucket: "edu-lms-e2f94.firebasestorage.app",
            messagingSenderId: "1023275038162",
            appId: "1:1023275038162:web:d746ff3b11ed64427c440b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Security Check
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // Not logged in
                window.location.href = "index.html";
            } else {
                // Logged in - verify session data matches
                const storedEmail = localStorage.getItem('loggedInUserId');
                if (storedEmail !== user.email) {
                    localStorage.setItem('loggedInUserId', user.email);
                }
            }
        });

        // Expose logout to global scope for the button
        window.logout = () => {
            if (confirm("Are you sure you want to log out?")) {
                signOut(auth).then(() => {
                    localStorage.removeItem('loggedInUserId');
                    localStorage.removeItem('userRole');
                    window.location.href = "index.html";
                }).catch((error) => {
                    console.error("Logout Error:", error);
                });
            }
        };
    </script>

    <script src="dashboard.js"></script>

</body>

</html>